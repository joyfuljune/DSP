# <div align = center>音频变速</div>

## 目录
- [简介](#0)
- [算法](#1)
   - [目的](#1-1)
   - [分帧](#1-2)
   - [加窗](#1-3)

<a name='0'></a>
## 简介
音频信号的时间压缩或扩展，也称为“时间拉伸”，是音高转换的倒数过程。它在改变速度（节奏）的同时保持信号音高不变。它的实现并没有想象中那么简单，让我们看一个简单但失败的案例。  

音频变速的一种直接的想法是对所有的语音信号进行插值处理，例如将一段时长为两分钟的语音信号拉伸为4分钟，可以设原始音频为N长，拉伸音频为2N，以最邻近插值法来说，假设音频信号为{1，2，3}，则拉伸后的数据为{1，1，2，2，3，3}。
下图是对一段音频的时域波形和以最邻近法作差值的结果。

| <img src="https://user-images.githubusercontent.com/88413945/180435539-31bdc8b6-b099-4525-bf2f-761c3ad3419c.png"/> | <img src="https://user-images.githubusercontent.com/88413945/180435560-850063f7-850b-4b1a-bc65-afdc9035412d.png"/> |
| :-------------: |:-------------:| 
| <b>图 1</b> 原始信号  | <b>图 2</b> 时域拉伸2倍信号 |

从图像上看，信号被拉长了2倍，原始音频约5秒，拉伸后接近10秒，且波形相似。但是聆听拉伸后的音频stretched.wav对比原始音频orig.wav可以发现在音高，或者说频率上变低了，而这是我们不希望发生的。反过来，如果我们希望对原始音频进行加速，例如由2分钟变成1分钟，一种直接的思路是抽取信号中的一半，如保留所有的偶数信号值。聆听加速后的音频信号compressed.wav会发现音高升高，同样是一种错误的结果。  

这种错误产生的原因很简单，图1和图2欺骗我们的地方在于他们的时间轴是不等的，如果将两者放在同一时间尺度下会得到3的情况，我们发现，在压缩时间的同时我们降低了频率，这就产生了音高的向下偏移。

| <img src="https://user-images.githubusercontent.com/88413945/180441234-05c054ae-4579-46b5-b934-4784d90a85a5.png"> | <img src="https://user-images.githubusercontent.com/88413945/180442790-67e84415-13e6-4da8-92b3-6fac63270abb.png"> |
| :-------------: |:-------------: |
| <b>图 3</b> 时间和频率对比图 | <b>图 4</b> 抽象性拉伸流程 |
  
所以正确的做法应该是维持时长不变，改变频率。通过频域插值计算得到压缩频率为原信号的1/2，再拉伸时长为原信号的2倍，即可得到原始频率的拉伸信号，其流程如图4所示。

<a name='1'></a>
## 算法  
我们现在将从数学的角度来看我们需要实现的算法。

<a name='1-1'></a>
### 目的  
我们知道必须在不改变音高的情况下改变信号持续时间。定义缩放因子为用于拉伸或压缩时长的变速因子，然后通过重新采样改变时长并回到初始音高。

<a name='1-2'></a>
### 分帧  
在对时域信号进行分析之前，有一个重要的先决操作被称为分帧（frame）。分帧的概念和上一次实验中分割信号的目的相同，都是为了获取更好的结果。但和上次实验的区别是，分帧一般涉及到重叠。例如，在先前的实验中，100点序列以20为帧长可以分为5段。分帧的重叠指的是如仍以100点序列，20点帧长进行分段，第一段是1-20，第二段则不是21-40，而是5-24或10-29等。所以我们需要定义另外一个变量叫做帧移，指的是两帧信号之间的距离。常用帧移的设定在帧长的25%~75%。  

| ![image](https://user-images.githubusercontent.com/88413945/180444080-df94be25-1fa8-403e-ade8-51a2fc15c33f.png) |  <b>图 5</b> 分帧处理后的重建
| - | - |

<a name='1-3'></a>
### 加窗  
分帧以后，我们还需要对每一帧信号作加窗处理。如图所示左侧一帧信号乘以窗函数得到右侧信号。我们发现原始帧信号的两端被削弱了，这样当我们分析处理的时候，得到的频谱图会更加准确。图中窗函数名为“Hanning Window”，中文为汉宁窗，此外，我们还有汉明窗，布莱克曼窗，三角窗等，都是作加窗处理时可选择的方法。
| ![image](https://user-images.githubusercontent.com/88413945/180444495-f3b756a4-2427-4297-9b7c-969cbc8ef9de.png) |
| :-: |
| <b>图 6</b> 时域信号（左）、汉宁窗（中）、加窗后时域信号（右） |






